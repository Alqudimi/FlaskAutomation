<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computer Vision Processing Platform | منصة معالجة الرؤية الحاسوبية</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-eye"></i>
                منصة الرؤية الحاسوبية
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#upload">تحميل الصور</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#processing">المعالجة</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#results">النتائج</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Control Panel -->
            <div class="col-lg-3 mb-4">
                <div class="card shadow">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-sliders-h"></i>
                            لوحة التحكم
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Upload Section -->
                        <div class="mb-4">
                            <h6 class="text-primary">
                                <i class="fas fa-upload"></i>
                                تحميل الصورة
                            </h6>
                            <div class="upload-area" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>اسحب الصورة هنا أو اضغط للتحديد</p>
                                <input type="file" id="imageInput" accept="image/*" hidden>
                            </div>
                        </div>

                        <!-- Processing Options -->
                        <div class="mb-4">
                            <h6 class="text-primary">
                                <i class="fas fa-cogs"></i>
                                خيارات المعالجة
                            </h6>
                            
                            <!-- Processing Type Tabs -->
                            <ul class="nav nav-pills nav-fill mb-3" id="processingTabs">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="pill" href="#featuresTab">
                                        <i class="fas fa-search"></i>
                                        الميزات
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="pill" href="#filtersTab">
                                        <i class="fas fa-filter"></i>
                                        المرشحات
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="pill" href="#matchingTab">
                                        <i class="fas fa-link"></i>
                                        المطابقة
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="pill" href="#transformTab">
                                        <i class="fas fa-sync-alt"></i>
                                        التحويل
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="pill" href="#batchTab">
                                        <i class="fas fa-layer-group"></i>
                                        متعدد
                                    </a>
                                </li>
                            </ul>

                            <!-- Tab Content -->
                            <div class="tab-content">
                                <!-- Features Tab -->
                                <div class="tab-pane fade show active" id="featuresTab">
                                    <div class="mb-3">
                                        <label class="form-label">نوع الميزة</label>
                                        <select class="form-select" id="featureType">
                                            <option value="fast_corners">زوايا FAST</option>
                                            <option value="hog">HOG</option>
                                            <option value="log_dog_blob">LoG/DoG Blob</option>
                                            <option value="orb">ORB</option>
                                            <option value="sift">SIFT</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Feature Parameters -->
                                    <div id="featureParameters">
                                        <!-- Dynamic parameters will be loaded here -->
                                    </div>
                                    
                                    <button class="btn btn-success w-100" id="extractFeaturesBtn">
                                        <i class="fas fa-play"></i>
                                        استخراج الميزات
                                    </button>
                                </div>

                                <!-- Filters Tab -->
                                <div class="tab-pane fade" id="filtersTab">
                                    <div class="mb-3">
                                        <label class="form-label">نوع المرشح</label>
                                        <select class="form-select" id="filterType">
                                            <option value="gaussian_blur">تمويه غاوسي</option>
                                            <option value="median_blur">تمويه متوسط</option>
                                            <option value="bilateral_filter">مرشح ثنائي</option>
                                            <option value="sobel">Sobel</option>
                                            <option value="canny">Canny</option>
                                            <option value="laplacian">Laplacian</option>
                                            <option value="histogram_equalization">توازن الهستوغرام</option>
                                            <option value="gamma_correction">تصحيح جاما</option>
                                            <option value="threshold">عتبة</option>
                                            <option value="adaptive_threshold">عتبة تكيفية</option>
                                            <option value="morphological">مورفولوجي</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Filter Parameters -->
                                    <div id="filterParameters">
                                        <!-- Dynamic parameters will be loaded here -->
                                    </div>
                                    
                                    <button class="btn btn-success w-100" id="applyFilterBtn">
                                        <i class="fas fa-play"></i>
                                        تطبيق المرشح
                                    </button>
                                </div>

                                <!-- Matching Tab -->
                                <div class="tab-pane fade" id="matchingTab">
                                    <div class="mb-3">
                                        <label class="form-label">الصورة الثانية</label>
                                        <div class="upload-area small" id="uploadArea2">
                                            <i class="fas fa-image"></i>
                                            <p>تحميل الصورة الثانية</p>
                                            <input type="file" id="imageInput2" accept="image/*" hidden>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">طريقة المطابقة</label>
                                        <select class="form-select" id="matchingMethod">
                                            <option value="FLANN">FLANN</option>
                                            <option value="BF_SIFT_RATIO">BF SIFT Ratio</option>
                                            <option value="BF_ORB_RATIO">BF ORB Ratio</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Matching Parameters -->
                                    <div id="matchingParameters">
                                        <div class="mb-3">
                                            <label class="form-label">عتبة النسبة</label>
                                            <input type="range" class="form-range" id="ratioThreshold" min="0.1" max="1" step="0.05" value="0.75">
                                            <small class="text-muted">القيمة: <span id="ratioThresholdValue">0.75</span></small>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-success w-100" id="matchFeaturesBtn" disabled>
                                        <i class="fas fa-play"></i>
                                        مطابقة الميزات
                                    </button>
                                </div>

                                <!-- Transform Tab -->
                                <div class="tab-pane fade" id="transformTab">
                                    <div class="mb-3">
                                        <label class="form-label">نوع التحويل</label>
                                        <select class="form-select" id="transformationType">
                                            <option value="translation">الإزاحة</option>
                                            <option value="rotation">التدوير</option>
                                            <option value="scaling">التحجيم</option>
                                            <option value="flip">القلب</option>
                                            <option value="crop">القص</option>
                                            <option value="resize">تغيير الحجم</option>
                                            <option value="color_adjustment">ضبط الألوان</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Transform Parameters -->
                                    <div id="transformParameters">
                                        <!-- Dynamic parameters will be loaded here -->
                                    </div>
                                    
                                    <button class="btn btn-success w-100" id="applyTransformBtn">
                                        <i class="fas fa-play"></i>
                                        تطبيق التحويل
                                    </button>
                                </div>

                                <!-- Batch Processing Tab -->
                                <div class="tab-pane fade" id="batchTab">
                                    <!-- Batch Operation Type -->
                                    <div class="mb-3">
                                        <label class="form-label">نوع العملية المتعددة</label>
                                        <select class="form-select" id="batchOperationType">
                                            <option value="multiple_features">ميزات متعددة</option>
                                            <option value="multiple_filters">مرشحات متعددة</option>
                                            <option value="multiple_transformations">تحويلات متعددة</option>
                                            <option value="filter_chain">سلسلة مرشحات</option>
                                            <option value="transformation_chain">سلسلة تحويلات</option>
                                            <option value="mixed_operations">عمليات مختلطة</option>
                                        </select>
                                    </div>

                                    <!-- Task Builder -->
                                    <div class="mb-3">
                                        <label class="form-label">إنشاء المهام</label>
                                        <div class="border rounded p-3" style="min-height: 120px;">
                                            <div id="taskList" class="mb-3">
                                                <!-- Dynamic task list will be populated here -->
                                            </div>
                                            <button class="btn btn-outline-primary btn-sm w-100" id="addTaskBtn">
                                                <i class="fas fa-plus"></i>
                                                إضافة مهمة جديدة
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Batch Processing Controls -->
                                    <div class="mb-3">
                                        <div class="row">
                                            <div class="col-6">
                                                <label class="form-label">عدد المعالجات</label>
                                                <select class="form-select form-select-sm" id="workerCount">
                                                    <option value="2">2</option>
                                                    <option value="4" selected>4</option>
                                                    <option value="6">6</option>
                                                    <option value="8">8</option>
                                                </select>
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label">التطبيق على</label>
                                                <select class="form-select form-select-sm" id="applyToImage">
                                                    <option value="current">الصورة الحالية</option>
                                                    <option value="original" selected>الصورة الأصلية</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success" id="processBatchBtn">
                                            <i class="fas fa-cogs"></i>
                                            تشغيل العملية المتعددة
                                        </button>
                                        <button class="btn btn-outline-secondary" id="clearTasksBtn">
                                            <i class="fas fa-trash"></i>
                                            مسح جميع المهام
                                        </button>
                                    </div>

                                    <!-- Progress Indicator -->
                                    <div class="mt-3 d-none" id="batchProgress">
                                        <div class="progress">
                                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                        </div>
                                        <small class="text-muted mt-1 d-block" id="batchProgressText">جاري المعالجة...</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="mb-4">
                            <h6 class="text-primary">
                                <i class="fas fa-tools"></i>
                                الإجراءات
                            </h6>
                            <div class="d-grid gap-2">
                                <button class="btn btn-warning" id="resetBtn">
                                    <i class="fas fa-undo"></i>
                                    إعادة تعيين
                                </button>
                                <button class="btn btn-info" id="downloadBtn">
                                    <i class="fas fa-download"></i>
                                    تحميل النتيجة
                                </button>
                            </div>
                        </div>

                        <!-- Processing History -->
                        <div class="mb-4">
                            <h6 class="text-primary">
                                <i class="fas fa-history"></i>
                                سجل المعالجة
                            </h6>
                            <div class="history-list" id="processingHistory">
                                <p class="text-muted small">لا توجد عمليات بعد</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Display Area -->
            <div class="col-lg-9">
                <!-- Results Display -->
                <div class="card shadow mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-images"></i>
                            عرض النتائج
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Original Image -->
                            <div class="col-md-6 mb-3">
                                <h6 class="text-center mb-2">الصورة الأصلية</h6>
                                <div class="image-container">
                                    <img id="originalImage" class="img-fluid" src="/static/placeholder-image.svg" alt="Original Image">
                                </div>
                            </div>
                            
                            <!-- Processed Image -->
                            <div class="col-md-6 mb-3">
                                <h6 class="text-center mb-2">النتيجة المعالجة</h6>
                                <div class="image-container">
                                    <img id="processedImage" class="img-fluid" src="/static/placeholder-image.svg" alt="Processed Image">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Loading Spinner -->
                        <div class="text-center d-none" id="loadingSpinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">جاري المعالجة...</span>
                            </div>
                            <p class="mt-2">جاري معالجة الصورة...</p>
                        </div>
                    </div>
                </div>

                <!-- Multiple Results Display -->
                <div class="card shadow mb-4 d-none" id="multipleResultsCard">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-layer-group"></i>
                            نتائج العمليات المتعددة
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Results Grid -->
                        <div class="row" id="multipleResultsGrid">
                            <!-- Dynamic multiple results will be displayed here -->
                        </div>
                        
                        <!-- Comparison Statistics -->
                        <div class="mt-4" id="comparisonStats">
                            <!-- Comparison data will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- Results Information -->
                <div class="card shadow">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle"></i>
                            معلومات النتائج
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Processing Statistics -->
                            <div class="col-md-6">
                                <h6 class="text-primary">إحصاءات المعالجة</h6>
                                <div id="processingStats">
                                    <p class="text-muted">لا توجد إحصاءات متاحة</p>
                                </div>
                            </div>
                            
                            <!-- Parameters Used -->
                            <div class="col-md-6">
                                <h6 class="text-primary">المعلمات المستخدمة</h6>
                                <div id="parametersUsed">
                                    <p class="text-muted">لا توجد معلمات متاحة</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="successToast" class="toast" role="alert">
            <div class="toast-header bg-success text-white">
                <i class="fas fa-check-circle me-2"></i>
                <strong class="me-auto">نجح</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="successMessage">
                تمت العملية بنجاح
            </div>
        </div>
        
        <div id="errorToast" class="toast" role="alert">
            <div class="toast-header bg-danger text-white">
                <i class="fas fa-exclamation-circle me-2"></i>
                <strong class="me-auto">خطأ</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="errorMessage">
                حدث خطأ أثناء العملية
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
